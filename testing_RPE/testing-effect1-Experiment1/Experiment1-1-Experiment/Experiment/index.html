<!DOCTYPE html>
<html>
  <head>
    <title>My experiment</title>
    <script src="jspsych-6.0.5/jspsych.js"></script>
    <script src = "jspsych-6.0.5/bowser.js"></script>
    <script src="jspsych-6.0.5/plugins/jspsych-html-keyboard-response.js"></script>
    <script src="jspsych-6.0.5/plugins/jspsych-image-keyboard-response.js"></script>
    <script src="jspsych-6.0.5/plugins/jspsych-survey-multi-choice.js"></script>
    <script src="jspsych-6.0.5/plugins/jspsych-html-slider-response.js"></script>
    <script src="jspsych-6.0.5/plugins/jspsych-preload.js"></script>
    <script src = "jspsych-6.0.5/plugins/jspsych-instructions.js"></script>
    <link href="jspsych-6.0.5/css/jspsych.css" rel="stylesheet" type="text/css"></link>
    <style>
      span {
        font-size:30px;
      }
      li {
        text-align: left;
      }
      ul {
        list-style: none;
      }
      
      #active_option {
        font-size: 30px;
        outline: 0.8px solid rgb(0, 0, 0);
        margin-top: 5px; 
        padding: 10px;
      }

      #unactive_option{
        font-size: 30px;
        margin-top: 4px;
        padding: 10px;
      }
      #option {
        font-size:30px;
        margin-top: 4px;
        padding: 10px;
      }
      #feedback {
        font-size:30px;
      }
      #correct{
        font-size:30px;
        color: green;
      }
      #wrong{
        font-size:30px;
        color:crimson;
      }
      #instructie{
        font-size:20px;
      }
    </style>
  </head>
  <body></body>
  <script>



/*---------------------------------------------------------------PHASE 1------------------------------------------------------------------*/ 


// SHUFFLE FUNCTION: shuffles array with seed
function shuffle(array, seed) { 
  var m = array.length, t, i;

  // While there remain elements to shuffle…
  while (m) {

    // Pick a remaining element…
    i = Math.floor(random(seed) * m--);

    // And swap it with the current element.
    t = array[m];
    array[m] = array[i];
    array[i] = t;
    ++seed                        
  }

  return array;
}

function random(seed) {
  var x = Math.sin(seed++) * 10000; 
  return x - Math.floor(x);
}

// PAIR DUTCH WORDS WITH TRANSLATION
function Wordpair_training(en, swa) {
    this.en = en;
    this.swa = swa;
  }

function Wordpair(en, swa, swar1, swar2, swar3) {
    this.en = en;
    this.swa_juist = swa;
    this.swa_rand1 = swar1;
    this.swa_rand2 = swar2;
    this.swa_rand3 = swar3
  }

// arrays with English and Swahili words
var woorden_training_en = ["bottle", "plane", "tea"];
var woorden_training_swa = ["ufunguo", "chai", "daftari"];
var extra_woorden_training_swa = ["kupika", "muguuzi", "dawati", "fizi", "umwagaji", "fimbo", "alama", "krismasi",
                                  "jua", "dhoruba", "kuchoma", "mwimbaji"]
//var woorden_en = ["tree" , "pen", "telephone", "notebook", "frame"];
var woorden_en = ["bed", "berry", "mosquito","pudding", "sock", "fish", "sun", "cat",
                  "boat", "bridge", "box", "donkey", "dog", "coffin", "knee", "lamp",
                  "basket", "nose", "window", "spider", "tooth", "flag", "fork", "wolf",
                  "column", "cop", "apple", "cup", "flower", "letter", "bread", "bucket",
                  "hammer", "candle", "spoon", "olive", "shelf", "shoe", "snake", "stone",
                  "marker", "wheel", "train", "gift", "hill", "ladder", "eel", "perfume",
                  "scissors", "cigar", "tomato", "finger", "shop", "curtain", "body", "ceiling",
                  "key", "tissue", "bonfire", "shoulder", "park", "cave", "salmon", "bank",
                  "clock", "rose", "picture", "book", "door", "human", "giraffe", "pants",
                  "woman", "sheet", "list", "mother", "music", "banana", "number", "page",
                  "mirror", "notebook", "office", "elephant", "poster", "triangle", "towel",
                  "magazine", "telephone", "squirrel", "puppet"];
//var woorden_swa = ["adui" , "hasira" , "nyota" , "mchuzi" , "kusanya"]; 
var woorden_swa = ['sabuni', 'sahani', 'samaki', 'sayari', 'sehemu', 'surali', 'tanuri', 'trekta', 'ufagio', 'ugomvi',
                  'madungog', 'mahitabo', 'mapintas', 'martilyo', 'napakyas', 'paghalad', 'paghukom', 'pagpalit',
                  'matumai', 'matumbo', 'mazishi', 'mchanga', 'mechezo', 'mgonjwa', 'msumari', 'mundamo',
                  'kazi', 'kioo','kisu', 'kiti', 'kito', 'leso', 'maji', 'mali', 'maua', 'mbwa', 'mkuu', 'moyo', 'mvua',
                  'pagsulod', 'pagtabon', 'pagtawag', 'pagtukod', 'pangalan', 'sensilyo', 'silingan', 'tindashan',
                  'adui', 'afya', 'aibu', 'basi', 'bega', 'buli', 'dari', 'duka', 'elfu', 'geza', 'goti', 'haki', 'hofu',
                  'jiwe', 'pamahaw', 'sulagma', 'tinapay', 'tuburan', 'bililhon', 'kabalaka', 'kasadpan', 'katuyoan',
                  'uyoga', 'wimbo', 'wingi', 'wingu', 'adhabu', 'bafuni', 'bahari', 'baiski', 'bunifu', 'chombo',
                  'kamwe', 'kemia', 'kesho', 'kiatu', 'kifua', 'kofia', 'kubwa', 'kumba', 'kweli', 'lugha', 'mamba',
                  'agalon', 'babaye'];

// Extra Swahili words (not the actual translations)
var extra_swa = ['nchi', 'osha', 'seri', 'simu', 'soko', 'twai', 'watu', 'kama', 'tena', 'mara', 'kuna', 'kila', 
                'bado', 'akili', 'amani', 'asili', 'barua', 'bendi', 'bloke', 'chaki', 'chuki', 'chuma', 'chupa', 
                'chupi', 'daima', 'fedha', 'funzi', 'gundi', 'hamsi', 'hatua', 'ijayo', 'imani', 'jansa', 'juuya', 
                'kamba', 'mbuzi', 'mdudu', 'mekno', 'mfuko', 'miaka', 'mkasi', 'mkate', 'mkboa', 'mraba', 'msitu', 
                'mtawa', 'mungu', 'mvuke', 'mwezi', 'nanga', 'ndege', 'ndezu', 'ndizi', 'ndogo', 'ndugu', 'ngazi', 
                'ngono', 'nogozi', 'nopya', 'nyota', 'nzuri', 'ofisi', 'panya', 'petye', 'picha', 'pombe', 'punda', 
                'pwani', 'rangi', 'shule', 'siagi', 'tembo', 'tumbo', 'uadui', 'uhuru', 'ukame', 'uongo', 'usiku', 
                'choori', 'dakika', 'daraja', 'dizeli', 'farasi', 'furaha', 'gorisi', 'godoro', 'guruwe', 'hasira', 
                'hazini', 'ishara', 'ishiri', 'jeraha', 'jibini', 'jikoni', 'jokofu', 'jumatu', 'kaburi', 'kahawa', 
                'kalamu', 'katika', 'kelele', 'kichwa', 'kidole', 'kihozi', 'kijiko', 'kikapu', 'kimysa', 'kinywa', 
                'kisiwa', 'kitovu', 'kovuli', 'kuacha', 'kubale', 'kuhesa', 'kununa', 'kunywa', 'kuzama', 'mageho', 
                'maisha', 'mapafu', 'mashua', 'mbolea', 'mchawi', 'mchuzi', 'mlango', 'mpishi', 'mtirka', 'mwanga', 
                'mzungu', 'ndoora', 'nyange', 'nyeusi', 'nyundo', 'nyundu', 'rafiki', 'rombus', 'ukweli', 'wakala', 
                'washia', 'welder', 'yatima', 'haraka', 'alizeti', 'baadaye', 'baharia', 'bandari', 'bilaska', 
                'bustani', 'chubani','filimbi', 'kartasi', 'kawaida', 'kengele', 'kitanda', 'kitande', 'kudhibi', 
                'kujenga', 'kukimba', 'kumbuka', 'kupanda','kusanya', 'kushoto', 'mvringo', 'mwanake', 'ndaniya', 
                'neyemba', 'punguza', 'shimoni', 'singizi', 'starehe', 'sufuria', 'sungura', 'takatak', 'tamasha', 
                'abug', 'ahos', 'asin', 'atay', 'atop', 'awit', 'baba', 'baga', 'baho', 'baki', 'bala', 'baso', 
                'bata', 'bili', 'bino', 'daub', 'dila', 'duga', 'edad', 'gabi', 'goma', 'hari', 'init', 'isda', 
                'itik', 'kaso', 'kawa', 'kopa', 'kuta', 'lima', 'liog', 'liso', 'lobo', 'lubi', 'luha', 'pala', 
                'pito', 'suga', 'suka', 'tawo', 'abang', 'baboy', 'bakus', 'bugas', 'dagat', 'ganti', 'gubat', 
                'gutom', 'hulma', 'iring', 'karon', 'lamok', 'layag', 'lisud', 'pilak', 'rayna', 'silya', 'taras', 
                'tubag', 'umaga', 'kasuko', 'kerida', 'kugita', 'lalake', 'napulo', 'pintal', 'pundok', 'salita', 
                'tambok', 'tualya', 'abogado', 'bahandi', 'bentaha', 'bulwawan', 'bungtod', 'estante', 'kabuang', 
                'kalipay', 'kamantis', 'kanding', 'kasamok', 'lamigas', 'mahugaw', 'pagduol', 'paghago', 'pahiyum', 
                'bituin', 'bunyag', 'skina', 'hagdan', 'hangyo', 'ihalas', 'kadaot', 'kaili', 'ulimwengu',
                'sweta', 'betri', 'utepe'];

// shuffle arrays
shuffle(woorden_en, 2);
shuffle(woorden_swa, 0);
shuffle(extra_swa,5);

// all the word pairs
var wordpairs_training = [];
var wordpairs = []; //array of 'wordpair' objects

// loop to put words in objects 
// TO DO: change 5 to total number of English words
for( i=0; i<3; i++){
  wordpairs_training[i] = new Wordpair_training(woorden_training_en[i], woorden_training_swa[i]);
}

for( i=0; i<90; i++){
  wordpairs[i] = new Wordpair(woorden_en[i], woorden_swa[i], extra_swa[3*i], extra_swa[3*i+1], extra_swa[3*i+2]);
  console.log(wordpairs[i]);
}

// shuffle extra Swahili array
shuffle(extra_swa, 2);

// Create timeline
var timeline = [];



timeline.push({
    type: "instructions",
    pages: ["<p>Welcome to this experiment.</p><p>Click on the button below to get started!</p>"],
    allow_keys: false,
    data: {useful_data: false},
    show_clickable_nav: true,
    on_start: function(trial){
      var browser_name = bowser.name
      if (browser_name == 'Safari'){
        trial.pages = ['The Safari webbrowser is not suited for this experiment.']
        jsPsych.endExperiment('The Safari webbrowser is not suited for this experiment.')
      } else {
        trial.pages = ["<p>Welcome to this experiment.</p><p>Click on the button below to get started!</p>"]
      }
    }
  });


var url_variable = jsPsych.data.urlVariables();
var participant_number = url_variable.PROLIFIC_PID;


//TIJDELIJK CATHY VERANDER DIT!!!!!!!
//var participant_number = 1;


// Define instructions trial 
var instructions_general1 = {
  type: "html-keyboard-response",
  stimulus: "<span  id= 'instructie' >This study is an experiment where we want to find out more about how people learn. <br>"+
            "For this, you will complete an experiment in which you will learn a new language. <br><br>"+
            "Press any key to continue.</span>",
  post_trial_gap: 100,
  data: {useful_data: false}
};
timeline.push(instructions_general1);

// Define instructions trial 
var instructions_general2 = {
  type: "html-keyboard-response",
  stimulus: "<span  id= 'instructie'>The experiment today consists of 3 parts.<br> You will start with part 1: the acquisition phase.<br><br> "+
            "Press any key to continue.</span>",
  post_trial_gap: 100,
  data: {useful_data: false}
};
timeline.push(instructions_general2);

var instructions_phase1 = {
  type: "html-keyboard-response",
  stimulus: "<span  id= 'instructie'><b>Part 1: the acquisition phase.</b><br><br> You will see an English word, paired with its foreign translation. <br>" +
            "You need to try to remember the foreign translation for each English word.<br><br>" + 
            "Do not worry if you cannot remember all the words right away. <br><br>" + 
            " Press any key to start the acquisition phase.</span>",
  post_trial_gap: 100,
  data: {useful_data: false}
};
timeline.push(instructions_phase1);

// Loop that displays all the wordpairs for 3 sec
    for( i = 0; i<wordpairs.length; i++){
        //Create stimulus
        var word_stimuli = {
            type: 'html-keyboard-response',
            stimulus: '<span>' + wordpairs[i].en + '&nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp &nbsp' + wordpairs[i].swa_juist + '</span>',
            choices: jsPsych.NO_KEYS,
            trial_duration: 3000,
            data: {useful_data: false}
        }
        // Push stimulus on the timeline
        timeline.push(word_stimuli); 
    }


/*
/*---------------------------------------------------------Phase 2---------------------------------------------------------*/
// Define instructions
var instructions_transition1to2 = {
    type: "html-keyboard-response",
    stimulus: "<span id= 'instructie'>This is the end of part 1: the acquisition phase.<br><br>" +
              "Press any key to continue.</span>",
    post_trial_gap: 100,
    data: {useful_data: false}
  };
  timeline.push(instructions_transition1to2);

var instructions_phase2part1 = {
    type: "html-keyboard-response",
    stimulus: "<span id= 'instructie'>Now we will continue with part 2: the testing phase.<br><br>" +
              "Press any key to continue.</span>",
    post_trial_gap: 100,
    data: {useful_data: false}
  };
  timeline.push(instructions_phase2part1);

var instructions_phase2part2 = {
    type: "html-keyboard-response",
    stimulus: "<span id= 'instructie'><b>Part 2: the testing phase.</b><br><br> You will see 1 English word, together with 4 possible translations.<br>" +
              "You need to indicate the correct translation by pressing f, v, n or j on the keyboard.<br><br>" +
              "Press any key to continue</span>",
    post_trial_gap: 100,
    data: {useful_data: false}
  };
  timeline.push(instructions_phase2part2);

  var instructions_phase2part3 = {
    type: "html-keyboard-response",
    stimulus: "<span  id= 'instructie'>After you gave your answer, you will indicate how certain you were about your answer.<br><br>" +
             "This will happen on a scale from 1 (very uncertain) to 5 (very certain).<br>" +
             "For this, you will need to use your mouse instead of your keyboard.<br><br>" +
             "Press any key to continue.</span>",
    post_trial_gap: 100,
     data: {useful_data: false}
  };
  timeline.push(instructions_phase2part3);

/*------------------------------------------TRAINING-----------------------------------*/
var instructions_phase2part4 = {
    type: "html-keyboard-response",
    stimulus: "<span  id= 'instructie'>We will first start with a short training session.<br><br>" +
             "Press any key to start.</span>",
    post_trial_gap: 100,
     data: {useful_data: false}
  };
  timeline.push(instructions_phase2part4);

for( i = 0; i<wordpairs_training.length; i++){
      var en_word = wordpairs_training[i].en;
      var correct_swa_word = wordpairs_training[i].swa;
      var swa_words = [extra_woorden_training_swa[4*i], extra_woorden_training_swa[4*i+1], extra_woorden_training_swa[4*i+2]];
      var index_juiste_swa = Math.floor(Math.random()*4);
      swa_words.splice(index_juiste_swa, 0, correct_swa_word);

      // Get correct answer: f,v,j or n
      var correct_answer = 'x';
         switch(index_juiste_swa) {
            case 0:
                correct_answer = 'f';
                break;
            case 1:
                correct_answer = 'v';
                break;
            case 2:
                correct_answer = 'j';
                break;
            case 3:
                correct_answer = 'n';
                break;
            default:
                console.log('error');
            }

        var html_stimulus = 
          '<table>\
            <tbody>\
              <tr>\
                <td><span>' + en_word + ' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></td>\
                <td>\
                  <p id = "option" > f) ' + swa_words[0] + '</p>\
                  <p id = "option" > v) ' + swa_words[1] + '</p>\
                </td>\
                <td>\
                  <p id = "option" > j) ' + swa_words[2] + '</p>\
                  <p id = "option" > n) ' + swa_words[3] + '</p>\
                </td>\
              </tr>\
            </tbody>\
          </table>';

        //Display English word w/ 4 Swahili options
        var multi_choice_block = {
            type : 'html-keyboard-response',
            stimulus: html_stimulus,
            choices : ['f' , 'v' , 'j', 'n'],
            data: {en_word: en_word, swa_word: correct_swa_word, correct_answer: correct_answer, useful_data: false, phase: 2},
            on_finish: function(data){ // Check if answer is correct
                var accuracy = false;
                if( data.correct_answer == jsPsych.pluginAPI.convertKeyCodeToKeyCharacter(data.key_press)){
                    accuracy = true;
                }
                data.input_answer =  jsPsych.pluginAPI.convertKeyCodeToKeyCharacter(data.key_press); // Add given answer to the dataset
                data.accuracy = accuracy;// Add accuracy to the dataset  
            }
        }

        //Display certainty rating scale
        var cert_rating = {
            type: 'html-slider-response',
            stimulus: ' &nbsp; &nbsp; &nbsp; &nbsp; How certain were you of your answer? &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </p>',
            labels: ['very uncertain', 'uncertain', 'neutral', 'certain', 'very certain'],
            min: 1,
            max: 5,
            step: 1,
            start: 3,
            require_movement: true,
            data: {useful_data: false, phase:2},
            }
          // Push stimulus on the timeline
        timeline.push(multi_choice_block, cert_rating); 
    };
    
/*------------------------------------------FOR REAL NOW-----------------------------------*/
var instructions_phase2part5 = {
    type: "html-keyboard-response",
    stimulus: "<span  id= 'instructie'> Now, we will start with the actual test.<br><br>" + 
             "Press any key to start.</span>",
    post_trial_gap: 100,
     data: {useful_data: false}
  };
  timeline.push(instructions_phase2part5);


// LOOP: display English word with 4 Swahili options. Choose 1 & afterwards indicate certainty
for( i = 0; i<wordpairs.length; i++){ 
        var en_word = wordpairs[i].en; // Get English word
        var correct_swa_word = wordpairs[i].swa_juist; // Get correct Swahili translation
        var swa_words = [wordpairs[i].swa_rand1,  wordpairs[i].swa_rand2, wordpairs[i].swa_rand3]; // Get multiple choice options
        var index_juiste_swa = Math.floor( Math.random()*4 ); // Generate index for correct Swahili word
        swa_words.splice(index_juiste_swa, 0, correct_swa_word); // Add correct Swahili word to array
        
        // Get correct answer: f,v,j or n
        var correct_answer = 'x';
        switch(index_juiste_swa) {
            case 0:
                correct_answer = 'f';
                break;
            case 1:
                 correct_answer = 'v';
                break;
            case 2:
                correct_answer = 'j';
                break;
            case 3:
                correct_answer = 'n';
                break;
            default:
                console.log('error');
            }

        var html_stimulus = 
          '<table>\
            <tbody>\
              <tr>\
                <td><span>' + en_word + ' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></td>\
                <td>\
                  <p id = "option" > f) ' + swa_words[0] + '</p>\
                  <p id = "option" > v) ' + swa_words[1] + '</p>\
                </td>\
                <td>\
                  <p id = "option" > j) ' + swa_words[2] + '</p>\
                  <p id = "option" > n) ' + swa_words[3] + '</p>\
                </td>\
              </tr>\
            </tbody>\
          </table>';

        //Display English word w/ 4 Swahili options
        var multi_choice_block = {
            type : 'html-keyboard-response',
            stimulus: html_stimulus,
            choices : ['f' , 'v' , 'j', 'n'],
            data: {en_word: en_word, options: swa_words, swa_word: correct_swa_word, correct_answer: correct_answer, useful_data: true, phase: 2},
            on_finish: function(data){ // Check if answer is correct
                var accuracy = false;
                if( data.correct_answer == jsPsych.pluginAPI.convertKeyCodeToKeyCharacter(data.key_press)){
                    accuracy = true;
                }
                data.input_answer =  jsPsych.pluginAPI.convertKeyCodeToKeyCharacter(data.key_press); // Add given answer to the dataset
                // add input word to dataset
                switch(data.input_answer){
                  case 'f': 
                    data.input_word = data.options[0]
                    console.log(data.input_word);
                    break;
                  case 'v':
                    data.input_word = data.options[1];
                    console.log(data.input_word);

                    break;
                  case 'j':
                    data.input_word = data.options[2];
                    console.log(data.input_word);

                    break;
                  case 'n':
                    data.input_word = data.options[3];
                    console.log(data.input_word);

                    break;
                  default:
                    console.log('fault');
                }
                data.accuracy = accuracy;// Add accuracy to the dataset  
            }
        }

        //Display certainty rating scale
        var cert_rating = {
            type: 'html-slider-response',
            stimulus: ' &nbsp; &nbsp; &nbsp; &nbsp; How certain were you of your answer? &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </p>',
            labels: ['very uncertain', 'uncertain', 'neutral', 'certain', 'very certain'],
            min: 1,
            max: 5,
            step: 1,
            start: 3,
            require_movement: true,
            data: {useful_data: true, phase:2},
            on_finish: function(data){
              jsPsych.data.get().addToLast({certainty: data.response});
            }
        };
        // Push stimulus on the timeline
        timeline.push(multi_choice_block, cert_rating); 

    }




/*--------------------------------------------------------Phase 3---------------------------------------------------------*/

var instructions_transition2to3 = {
    type: "html-keyboard-response",
    stimulus: "<span  id= 'instructie'>This is the end of part 2: the first testing phase<br><br>" +
              "Press any key to continue.</span>",
    post_trial_gap: 100,
    data: {useful_data: false}
  };
  timeline.push(instructions_transition2to3);

// Define instructions trial 
var instructions_phase3part1 = {
    type: "html-keyboard-response",
    stimulus: "<span  id= 'instructie'><b>Part 3: the second testing phase</b><br><br> Now we will continue with the second testing phase.<br><br>" +
              "Press any key to continue.</span>",
    post_trial_gap: 100,
    data: {useful_data: false}
  };
  timeline.push(instructions_phase3part1);

var instructions_phase3part2 = {
    type: "html-keyboard-response",
    stimulus: "<span id= 'instructie'>You will see 1 English word, together with 4 possible translations.<br>" +
              "The important difference with the first testing phase is that the eligible translations will be framed.<br><br>" +
              "Press any key to continue.</span>",
    post_trial_gap: 100,
    data: {useful_data: false}
  };
  timeline.push(instructions_phase3part2);

var instructions_phase3part3 = {
    type: "html-keyboard-response",
    stimulus: "<span id= 'instructie'>For example, if all 4 translations are framed, this means you need to choose the correct translation from those 4 options.<br>" +
              "If only 1 translation is framed, this means this is the only translation you can choose."+
              "In other words, that one is the correct translation.<br><br>" +
             "Press any key to continue.</span>",
    post_trial_gap: 100,
     data: {useful_data: false}
  };
  timeline.push(instructions_phase3part3);

var instructions_phase3part4 = {
    type: "html-keyboard-response",
    stimulus: "<span id= 'instructie'>You need to indicate the correct translation by pressing f, v, n or j on the keyboard.<br><br>" +
              "Press any key to continue.</span>",
    post_trial_gap: 100,
     data: {useful_data: false}
  };
  timeline.push(instructions_phase3part4);

var instructions_phase3part5 = {
    type: "html-keyboard-response",
    stimulus: "<span id= 'instructie'>After you gave your answer, you will indicate how certain you were about your answer.<br>" +
             "This will happen on a scale from 1 (very uncertain) to 5 (very certain).<br>" +
             "For this, you will need to use your mouse instead of your keyboard.<br><br>" +
             "Press any key to continue.</span>",
    post_trial_gap: 100,
     data: {useful_data: false}
  };
  timeline.push(instructions_phase3part5);

var instructions_phase3part6 = {
    type: "html-keyboard-response",
    stimulus: "<span  id= 'instructie'>Afterwards, your answer will be shown again, along with the correct answer.<br><br>" +
              "If you gave the wrong answer, this is the ideal opportunity to learn the word again.<br>" +
              "After you read your feedback carefully, you can press any key to continue.<br><br>" +
              "Press any key to start.</span>",
    post_trial_gap: 100,
     data: {useful_data: false}
  };
  timeline.push(instructions_phase3part6);

  var active_options = new Array(wordpairs.length);
          for(var i = 0; i<active_options.length ;i++){
            if(i < active_options.length * 0.2){
              active_options[i] = false;
            }
            else{
              active_options[i] = true;
            }
          }
  shuffle(active_options, 0);

// LOOP: display English word with 4 Swahili options. Choose 1 & afterwards indicate certainty
shuffle(wordpairs, 2);

console.log("hallo we hebben geshuffelt")

for( i = 0; i<wordpairs.length; i++){
        var en_word = wordpairs[i].en; // Get English word
        var correct_swa_word = wordpairs[i].swa_juist; // Get correct Swahili translation
        var swa_words = [wordpairs[i].swa_rand1,  wordpairs[i].swa_rand2, wordpairs[i].swa_rand3]; // Get multiple choice options
        var index_juiste_swa = Math.floor( Math.random()*4 ); // Generate index for correct Swahili word
        swa_words.splice(index_juiste_swa, 0, correct_swa_word); // Add correct Swahili word to array
        

        // Get correct answer: f,v,j or n
        var correct_answer = 'x';
        switch(index_juiste_swa){ 
            case 0:
                correct_answer = 'f';
                break;
            case 1:
                 correct_answer = 'v';
                break;
            case 2:
                correct_answer = 'j';
                break;
            case 3:
                correct_answer = 'n';
                break;
            default:
                console.log('fault');
            }
        
        // Function to generate stimulus and choices
        function get_stimulus(){ 
          var all_options_active = true;
          var random = Math.floor(Math.random()*100);

          // 20% of the time only one option will be active
          if(active_options[i]  == false){
            all_options_active = false;
          }  

          if(all_options_active == true){
            var choices = ['f' , 'v' , 'j', 'n'];
            //stimulus formated in html
            var html_stimulus = 
            '<table>\
              <tbody>\
                <tr>\
                  <td><span>' + en_word + ' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></td>\
                  <td>\
                    <p id = "active_option" > f) ' + swa_words[0] + '</p>\
                    <p id = "active_option" > v) ' + swa_words[1] + '</p>\
                  </td>\
                  <td>\
                    <p id = "active_option" > j) ' + swa_words[2] + '</p>\
                    <p id = "active_option" > n) ' + swa_words[3] + '</p>\
                  </td>\
                </tr>\
              </tbody>\
            </table>';
            

            return {
              html_stimulus,
              choices
            };
          }
          else{
            var option1 = 'unactive_option';
            var option2 = 'unactive_option';
            var option3 = 'unactive_option';
            var option4 = 'unactive_option';
            var choices;
            // change css id for correct answer 
            switch(index_juiste_swa) {
              case 0:
                  option1 = 'active_option';
                  choices = ['f'];
                  break;
              case 1:
                  option2 = 'active_option';
                  choices = ['v'];
                  break;
              case 2:
                  option3 = 'active_option';
                  choices = ['j'];
                  break;
              case 3: 
                  option4 = 'active_option';
                  choices = ['n'];
                  break;
              default:
                  console.log('fault');
              }

            //stimulus formated in html
            var html_stimulus = 
            '<table>\
              <tbody>\
                <tr>\
                  <td><span>' + en_word + ' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></td>\
                  <td>\
                    <p id = '+ option1 +' > f) ' + swa_words[0] + '</p>\
                    <p id = '+ option2 +' > v) ' + swa_words[1] + '</p>\
                  </td>\
                  <td>\
                    <p id = '+ option3 +' > j) ' + swa_words[2] + '</p>\
                    <p id = '+ option4 +' > n) ' + swa_words[3] + '</p>\
                  </td>\
                </tr>\
              </tbody>\
            </table>';
            return {
              html_stimulus,
              choices
            };
          }
        }

        var stimulus_object = get_stimulus(); // run function to get stimulus and choices
        var stimulus = stimulus_object.html_stimulus; // get stimulus
        var choices = stimulus_object.choices; // get choices
        console.log(choices);

        //Display English word w/ 4 Swahili options
        var multi_choice_block_phase3 = {
            type : 'html-keyboard-response',
            stimulus: stimulus,
            choices : choices,
            data: {en_word: en_word, options: swa_words, swa_word: correct_swa_word, correct_answer: correct_answer, useful_data: true, phase:3, amt_choices: choices.length},
            on_finish: function(data){ // Check if answer is correct
                var accuracy = false;
                if( data.correct_answer == jsPsych.pluginAPI.convertKeyCodeToKeyCharacter(data.key_press)){
                    accuracy = true;
                }
                data.input_answer =  jsPsych.pluginAPI.convertKeyCodeToKeyCharacter(data.key_press); // Add given answer to the dataset
                // add input word to dataset
                switch(data.input_answer){
                  case 'f': 
                    data.input_word = data.options[0]
                    console.log(data.input_word);
                    break;
                  case 'v':
                    data.input_word = data.options[1];
                    console.log(data.input_word);

                    break;
                  case 'j':
                    data.input_word = data.options[2];
                    console.log(data.input_word);

                    break;
                  case 'n':
                    data.input_word = data.options[3];
                    console.log(data.input_word);

                    break;
                  default:
                    console.log('fault');
                }
                data.accuracy = accuracy;// Add accuracy to the dataset  
            }
        }

        //Display certainty rating scale
        var cert_rating_phase3 = {
            type: 'html-slider-response',
            stimulus: ' &nbsp; &nbsp; &nbsp; &nbsp; How certain were you of your answer? &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </p>',
            labels: ['very uncertain', 'uncertain', 'neutral', 'certain', 'very certain'],
            min: 1,
            max: 5,
            step: 1,
            start: 3,
            require_movement: true,
            data: {useful_data: true, phase: 3},
            on_finish: function(data){
              jsPsych.data.get().addToLast({certainty: data.response});
            }
        };

        var feedback_phase3 = {
            type: 'html-keyboard-response',
            stimulus: function(){
              var length = jsPsych.data.get().count(); // get trail count
              var en = jsPsych.data.get().values()[length-2].en_word; // get Englsih word from last multichoice trail
              var last_response = jsPsych.data.get().values()[length-2].input_word; // get input response from last multichoice trail
              var correct_response = jsPsych.data.get().values()[length-2].swa_word; // get correct response from last multichoice trail
              var correct = jsPsych.data.get().values()[length-2].accuracy; // get the accuracy from the last multichoice trial

              if(correct){
                // generate stimulus
              var stimulus = '<p id = correct > Correct! </p> \
                              <p id = feedback> Your answer: ' + en +' = ' + last_response + '</span></p> \
                              <p id = feedback> The correct answer: ' + en + ' = ' + correct_response + '</p>\
                              <p id = feedback> <br><br> Press any key to continue </p>';
              }
              else{
                   // generate stimulus
              var stimulus = '<p id = wrong > Wrong! </p> \
                              <p id = feedback> Your answer: ' + en +' = ' + last_response + '</span></p> \
                              <p id = feedback> The correct answer: ' + en + ' = ' + correct_response + '</p>\
                              <p id = feedback> <br><br> Press any key to continue </p>';
              } 
              return stimulus
            },
            data: {useful_data: true, phase: 3},
            on_finish: function(data){
              jsPsych.data.get().addToLast({certainty: data.response});
            },
           
        };
        // Push stimulus on the timeline
        timeline.push(multi_choice_block_phase3, cert_rating_phase3, feedback_phase3); 
    }




/*--------------------------------------------------BREAK AND FILLER TASK---------------------------------------------------------*/ 

/* experiment parameters*/
var reps_per_trial_type = 80;

/*set up welcome block*/
var welcome = {
  type: "html-keyboard-response",
  stimulus: "Now we will switch to another task. Press any key to continue.",
  data: {useful_data: false}
};

/*set up instructions block*/
var instructions = {
  type: "html-keyboard-response",
  stimulus: "<p>In this task, you will see five arrows on the screen, like the example below.</p>"+
    "<img src='img/inc1.png'></img>"+
    "<p>Press the left arrow key if the middle arrow is pointing left. (<)</p>"+
    "<p>Press the right arrow key if the middle arrow is pointing right. (>)</p>"+
    "<p>Press any key to begin.</p>",
  post_trial_gap: 1000,
  data: {useful_data: false}
};

/*defining stimuli*/
var test_stimuli = [
  {
    stimulus: "img/con1.png",
    data: { stim_type: 'congruent', direction: 'left'}
  },
  {
    stimulus: "img/con2.png",
    data: { stim_type: 'congruent', direction: 'right'}
  },
  {
    stimulus: "img/inc1.png",
    data: { stim_type: 'incongruent', direction: 'right'}
  },
  {
    stimulus: "img/inc2.png",
    data: { stim_type: 'incongruent', direction: 'left'}
  }
];

/* defining test timeline */
var test = {
  timeline: [{
    type: 'image-keyboard-response',
    choices: ['leftarrow', 'rightarrow'],
    trial_duration: 1500,
    response_ends_trial: true,
    stimulus: jsPsych.timelineVariable('stimulus'),
    data: jsPsych.timelineVariable('data'),
    on_finish: function(data){
      var correct = false;
      if(data.direction == 'left' && jsPsych.pluginAPI.compareKeys(data.response, 'leftarrow') && data.rt > -1){
        correct = true;
      } else if(data.direction == 'right' && jsPsych.pluginAPI.compareKeys(data.response, 'rightarrow') && data.rt > -1){
        correct = true;
      }
      data.correct = correct;
    },
    post_trial_gap: function() {
        return Math.floor(Math.random() * 1500) + 500;
    }
  }],
  timeline_variables: test_stimuli,
  sample: {type: 'fixed-repetitions', size: reps_per_trial_type}
};

/*
// manually preload images due to presenting them with timeline variables
var images = ["img/con1.png","img/con2.png","img/inc1.png","img/inc2.png"];
var preload = {
  type: 'preload',
  images: images
};

/*set up experiment structure*/
//timeline.push(preload);
timeline.push(welcome);
timeline.push(instructions);
timeline.push(test);

/*---------------------------------------------------------Phase 4---------------------------------------------------------*/ 

var instructions_phase4part1 = {
    type: "html-keyboard-response",
    stimulus: "<span  id= 'instructie'>Now we will start with another testing phase. <br><br>" +
              "Press any key to continue.</span>",
    post_trial_gap: 100,
    data: {useful_data: false}
  };
  timeline.push(instructions_phase4part1);

var instructions_phase4part2 = {
    type: "html-keyboard-response",
    stimulus: "<span  id= 'instructie'>You will see 1 English word, together with 4 possible translations.<br>" +
              "You need to indicate the correct translation by pressing f, v, n or j on the keyboard.<br><br>" +
              "Press any key to continue.</span>",
    post_trial_gap: 100,
    data: {useful_data: false}
  };
  timeline.push(instructions_phase4part2);

var instructions_phase4part3 = {
    type: "html-keyboard-response",
    stimulus: "<span  id= 'instructie'>After you gave your answer, you will indicate how certain you were about your answer.<br>" +
             "This will happen on a scale from 1 (very uncertain) to 5 (very certain).<br>" +
             "For this, you will need to use your mouse instead of your keyboard.<br><br>" +
             "Press any key to continue.</span>",
    post_trial_gap: 100,
    data: {useful_data: false}
    };
  timeline.push(instructions_phase4part3);

shuffle(wordpairs, 5);
// LOOP: display English word with 4 Swahili options. Choose 1 & afterwards indicate certainty
for( i = 0; i<wordpairs.length; i++){
        var en_word = wordpairs[i].en; // Get English word
        var correct_swa_word = wordpairs[i].swa_juist; // Get correct Swahili translation
        var swa_words = [wordpairs[i].swa_rand1,  wordpairs[i].swa_rand2, wordpairs[i].swa_rand3]; // Get multiple choice options
        var index_juiste_swa = Math.floor( Math.random()*4 ); // Generate index for correct Swahili word
        swa_words.splice(index_juiste_swa, 0, correct_swa_word); // Add correct Swahili word to array
        
        // Get correct answer: f,v,j or n
        var correct_answer = 'x';
        switch(index_juiste_swa) {
            case 0:
                correct_answer = 'f';
                break;
            case 1:
                 correct_answer = 'v';
                break;
            case 2:
                correct_answer = 'j';
                break;
            case 3:
                correct_answer = 'n';
                break;
            default:
                console.log('error');
            }

        //stimulus formated in html
        var html_stimulus = 
          '<table>\
            <tbody>\
              <tr>\
                <td><span>' + en_word + ' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></td>\
                <td>\
                  <p id = "option" > f) ' + swa_words[0] + '</p>\
                  <p id = "option" > v) ' + swa_words[1] + '</p>\
                </td>\
                <td>\
                  <p id = "option" > j) ' + swa_words[2] + '</p>\
                  <p id = "option" > n) ' + swa_words[3] + '</p>\
                </td>\
              </tr>\
            </tbody>\
          </table>';   

        //Display English word w/ 4 Swahili options
        var multi_choice_block_phase4 = {
            type : 'html-keyboard-response',
            stimulus: html_stimulus,
            choices : ['f' , 'v' , 'j', 'n'],
            data: {en_word: en_word, options: swa_words, swa_word: correct_swa_word, correct_answer: correct_answer,useful_data: true, phase: 4},
            on_finish: function(data){ // Check if answer is correct
                var accuracy = false;
                if( data.correct_answer == jsPsych.pluginAPI.convertKeyCodeToKeyCharacter(data.key_press)){
                    accuracy = true;
                }
                data.input_answer =  jsPsych.pluginAPI.convertKeyCodeToKeyCharacter(data.key_press); // Add given answer to the dataset
                // add input word to dataset
                switch(data.input_answer){
                  case 'f': 
                    data.input_word = data.options[0]
                    console.log(data.input_word);
                    break;
                  case 'v':
                    data.input_word = data.options[1];
                    console.log(data.input_word);

                    break;
                  case 'j':
                    data.input_word = data.options[2];
                    console.log(data.input_word);

                    break;
                  case 'n':
                    data.input_word = data.options[3];
                    console.log(data.input_word);

                    break;
                  default:
                    console.log('fault');
                }
                data.accuracy = accuracy;// Add accuracy to the dataset  
            }
        }

        //Display certainty rating scale
        var cert_rating_phase4 = {
            type: 'html-slider-response',
            stimulus: ' &nbsp; &nbsp; &nbsp; &nbsp; How certain were you of your answer? &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </p>',
            labels: ['very uncertain', 'uncertain', 'neutral', 'certain', 'very certain'],
            min: 1,
            max: 5,
            step: 1,
            start: 3,
            require_movement: true,
            data: {useful_data: true, phase:4},
            on_finish: function(data){
              jsPsych.data.get().addToLast({certainty: data.response});
            }
        };
        // Push stimulus on the timeline
        timeline.push(multi_choice_block_phase4, cert_rating_phase4); 

    }

/*---------------------------------------------------------Phase 5---------------------------------------------------------*/ 
var instructions_phase5 = {
    type: "html-keyboard-response",
    stimulus: "<span  id= 'instructie'>You can take a break here.<br><br> Press any key to take the test one last time.</span>",
    post_trial_gap: 100,
    data: {useful_data: false}
  };
  timeline.push(instructions_phase5);


shuffle(wordpairs,4);
// LOOP: display English word with 4 Swahili options. Choose 1 & afterwards indicate certainty
for( i = 0; i<wordpairs.length; i++){
        var en_word = wordpairs[i].en; // Get English word
        var correct_swa_word = wordpairs[i].swa_juist; // Get correct Swahili translation
        var swa_words = [wordpairs[i].swa_rand1,  wordpairs[i].swa_rand2, wordpairs[i].swa_rand3]; // Get multiple choice options
        var index_juiste_swa = Math.floor( Math.random()*4 ); // Generate index for correct Swahili word
        swa_words.splice(index_juiste_swa, 0, correct_swa_word); // Add correct Swahili word to array
        
        // Get correct answer: f,v,j or n
        var correct_answer = 'x';
        switch(index_juiste_swa) {
            case 0:
                correct_answer = 'f';
                break;
            case 1:
                 correct_answer = 'v';
                break;
            case 2:
                correct_answer = 'j';
                break;
            case 3:
                correct_answer = 'n';
                break;
            default:
                console.log('error');
            }

        //stimulus formated in html
        var html_stimulus = 
          '<table>\
            <tbody>\
              <tr>\
                <td><span>' + en_word + ' &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </span></td>\
                <td>\
                  <p id = "option" > f) ' + swa_words[0] + '</p>\
                  <p id = "option" > v) ' + swa_words[1] + '</p>\
                </td>\
                <td>\
                  <p id = "option" > j) ' + swa_words[2] + '</p>\
                  <p id = "option" > n) ' + swa_words[3] + '</p>\
                </td>\
              </tr>\
            </tbody>\
          </table>';   

        //Display English word w/ 4 Swahili options
        var multi_choice_block_phase4 = {
            type : 'html-keyboard-response',
            stimulus: html_stimulus,
            choices : ['f' , 'v' , 'j', 'n'],
            data: {en_word: en_word, options: swa_words, swa_word: correct_swa_word, correct_answer: correct_answer,useful_data: true, phase: 5},
            on_finish: function(data){ // Check if answer is correct
                var accuracy = false;
                if( data.correct_answer == jsPsych.pluginAPI.convertKeyCodeToKeyCharacter(data.key_press)){
                    accuracy = true;
                }
                data.input_answer =  jsPsych.pluginAPI.convertKeyCodeToKeyCharacter(data.key_press); // Add given answer to the dataset
                // add input word to dataset
                switch(data.input_answer){
                  case 'f': 
                    data.input_word = data.options[0]
                    console.log(data.input_word);
                    break;
                  case 'v':
                    data.input_word = data.options[1];
                    console.log(data.input_word);

                    break;
                  case 'j':
                    data.input_word = data.options[2];
                    console.log(data.input_word);

                    break;
                  case 'n':
                    data.input_word = data.options[3];
                    console.log(data.input_word);

                    break;
                  default:
                    console.log('fault');
                }
                data.accuracy = accuracy;// Add accuracy to the dataset  
            }
        }

        //Display certainty rating scale
        var cert_rating_phase4 = {
            type: 'html-slider-response',
            stimulus: ' &nbsp; &nbsp; &nbsp; &nbsp; How certain were you of your answer? &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; </p>',
            labels: ['very uncertain', 'uncertain', 'neutral', 'certain', 'very certain'],
            min: 1,
            max: 5,
            step: 1,
            start: 3,
            require_movement: true,
            data: {useful_data: true, phase:5},
            on_finish: function(data){
              jsPsych.data.get().addToLast({certainty: data.response});
            }
        };
        // Push stimulus on the timeline
        timeline.push(multi_choice_block_phase4, cert_rating_phase4); 

    }


//---------------------------------------------------END AND STORE DATA------------------------------------------------------------

var instructions_end = {
    type: "html-keyboard-response",
    stimulus: "<span  id= 'instructie' >That's it! Thank you for your participation.<br><br> Press any key to end the experiment.</span>",
    post_trial_gap: 100,
    data: {useful_data: false}
  };
  timeline.push(instructions_end);


function saveData(name, data){
  var xhr = new XMLHttpRequest();
  xhr.open('POST', 'write_data.php');
  xhr.setRequestHeader('Content-Type', 'application/json');
  xhr.send(JSON.stringify({filename: name, filedata: data}));
}

    // Start the experiment
    jsPsych.init({
      timeline: timeline,
      on_finish: function() {
        jsPsych.data.displayData();
        saveData("Data_participant_" + participant_number,  jsPsych.data.get().filter({useful_data: true}).ignore('stimulus').ignore('internal_node_id').ignore('key_press').ignore('time_elapsed').ignore('response').ignore('useful_data').csv());
        setTimeout("location.href = 'https://app.prolific.co/submissions/complete?cc=77DFE070'", 3000)
        jsPsych.data.get().filter({useful_data: true}).ignore('stimulus').ignore('internal_node_id').ignore('key_press').ignore('time_elapsed').ignore('response').ignore('useful_data').localSave('csv','phase1_3.csv');
      }
    });



// Select all trials
var all_data = jsPsych.data.get();

// Get csv representation of data and log to console
console.log(all_data.csv());

  </script>
  </html>